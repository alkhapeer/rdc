<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="theme-color" content="#0ea5e9"/>
  <title data-i18n="app.title">نظام البطاقات (RDC) — إصدار عام</title>
  <link rel="manifest" href="manifest.json"/>
  <link rel="icon" href="icon-192.png"/>
  <link rel="stylesheet" href="styles.css"/>
  <script>
    if('serviceWorker' in navigator){ 
      addEventListener('load',()=>navigator.serviceWorker.register('./service-worker.js').catch(console.error)); 
    }
  </script>
</head>
<body>
  <header>
    <div class="container hero">
      <div class="brand">
        <span class="badge">PWA</span>
        <h1 data-i18n="app.title">نظام البطاقات (RDC) — إصدار عام</h1>
      </div>
      <div class="row">
        <button id="btn-install" class="btn pill hidden" data-i18n="app.install">تنصيب التطبيق</button>
        <div class="lang-switch">
          <button id="btn-ar" class="btn pill">العربية</button>
          <button id="btn-en" class="btn pill">English</button>
        </div>
      </div>
    </div>
    <div class="container">
      <nav class="tabs" id="tabs">
        <button class="tab-btn" data-target="tab-check" data-i18n="tabs.check">التحقق</button>
        <button class="tab-btn" data-target="tab-my" data-i18n="tabs.my">بطاقاتي</button>
        <button class="tab-btn" data-target="tab-issue" data-i18n="tabs.issue">إصدار بطاقة رقمية</button>
        <button class="tab-btn active" data-target="tab-guide" data-i18n="tabs.guide">الإرشادات</button>
        <button class="tab-btn" data-target="tab-renew" data-i18n="tabs.renew">تجديد</button>
        <button class="tab-btn" data-target="tab-contact">تواصل معنا</button>
      </nav>
    </div>
  </header>

  <main class="container">

    <!-- تحقق -->
    <section id="tab-check">
      <div class="card">
        <label data-i18n="check.label">Card ID</label>
        <div class="row">
          <input id="check-id" data-i18n-ph="check.ph" placeholder="RDCXXXX-ABC123" style="flex:1"/>
          <button id="btn-check" class="btn primary" data-i18n="check.btn">تحقّق</button>
        </div>
        <div id="check-result" style="margin-top:.6rem"></div>
      </div>
    </section>

    <!-- بطاقاتي -->
    <section id="tab-my">
      <div class="card">
        <h3 style="margin:0 0 .5rem" data-i18n="my.title">بطاقاتي</h3>
        <div id="my-cards" class="grid"></div>
        <small class="muted" data-i18n="my.empty">لا توجد بطاقات محفوظة بعد.</small>
      </div>
    </section>

    <!-- إصدار بطاقة -->
    <section id="tab-issue">
      <div class="card">
        <h3 style="margin:0 0 .5rem" data-i18n="issue.title">إصدار بطاقة رقمية قابلة للتحميل</h3>
        <label data-i18n="issue.idLabel">Card ID (يجب أن يبدأ بـ RDC)</label>
        <input id="issue-id" placeholder="RDCXXXX-ABC123"/>
        <label data-i18n="issue.name">الاسم على البطاقة</label>
        <input id="issue-name" placeholder="الاسم"/>
        <label data-i18n="issue.phone">الهاتف (اختياري)</label>
        <input id="issue-phone" placeholder="+201234567890"/>
        <label data-i18n="issue.photo">صورة شخصية (اختياري)</label>
        <input id="issue-photo" type="file" accept="image/*"/>
        <div class="row" style="margin-top:.6rem">
          <button id="btn-generate-card" class="btn primary" data-i18n="issue.btn">توليد وتنزيل</button>
        </div>
        <div id="card-preview" class="row" style="margin-top:.75rem"></div>
      </div>
    </section>

    <!-- الإرشادات -->
    <section id="tab-guide" class="active">
      <div class="card">
        <h3 style="margin:0 0 .5rem" data-i18n="guide.title">الإرشادات / البزنس بلان</h3>
        <p data-i18n="guide.desc">هذا الإصدار عام — يعتمد على ملف cards-public.json الذي ترفعه مع الملفات.</p>
      </div>

      <div class="card">
        <h3 style="margin:0 0 .5rem" data-i18n="guide.mediaTitle">محتوى تعليمي</h3>
        <div class="row">
          <button id="btn-open-pdf" class="btn pill hidden" data-i18n="guide.openPdf">فتح الدليل (guide.pdf)</button>
          <small id="guide-missing" class="muted hidden" data-i18n="guide.missing">ارفع الملفات بجوار index.html</small>
        </div>
        <video id="video-player" class="hidden" controls playsinline style="margin-top:.5rem;border-radius:12px;max-width:100%"></video>
      </div>
    </section>

    <!-- تجديد -->
    <section id="tab-renew">
      <div class="card">
        <h3 style="margin:0 0 .5rem" data-i18n="renew.title">تجديد / التواصل مع الإدارة</h3>
        <label data-i18n="renew.label">Card ID</label>
        <div class="row">
          <input id="renew-id" placeholder="RDCXXXX-ABC123" style="flex:1"/>
          <button id="btn-renew" class="btn primary" data-i18n="renew.btn">فتح واتساب</button>
        </div>
        <small class="muted" data-i18n="renew.note">سيتم تجهيز رسالة جاهزة.</small>
      </div>
    </section>

    <!-- تواصل معنا -->
    <section id="tab-contact">
      <div class="card">
        <h3>تواصل معنا / Contact Us</h3>
        <p>اضغط الزر لفتح نموذج التواصل في نافذة جديدة (Google Forms).</p>
        <button class="btn primary"
          onclick="window.open('https://docs.google.com/forms/d/e/1FAIpQLSem_8RjWAryclLqgTaaTLqz1CYg6zCmtfl9N1UyDY1gfOoo5A/viewform','_blank')">
          فتح النموذج
        </button>
      </div>
    </section>

  </main>

  <!-- Terms Modal -->
  <div id="overlay" class="overlay hidden" aria-hidden="true"></div>
  <div id="terms-modal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3 style="margin:0 0 .5rem" data-i18n="terms.title">الشروط والسياسات</h3>
      <div style="max-height:42vh;overflow:auto">
        <p data-i18n="terms.brief">مختصر: البطاقات شخصية وتُفعّل بعد الدفع. يمنع العبث.</p>
      </div>
      <label class="row" style="margin:.75rem 0">
        <input type="checkbox" id="terms-check"><span style="margin-inline-start:.5rem" data-i18n="terms.agree">أوافق</span>
      </label>
      <button id="btn-accept-terms" class="btn primary" disabled data-i18n="terms.btn">موافق</button>
    </div>
  </div>

  <footer class="container"><small class="muted">© 2025 — Public PWA</small></footer>
  <script type="module" src="app.js"></script>
</body>
</html>
